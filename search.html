<!DOCTYPE html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ค้นหาข้อมูลพนักงาน</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        input, select, button { margin: 5px; padding: 8px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        th { background-color: #f4f4f4; }
    </style>
</head>
<body>

    <h2>ค้นหาข้อมูลพนักงาน</h2>

    <select id="searchColumn">
        <option value="รหัสพนักงาน">รหัสพนักงาน</option>
        <option value="ชื่อ-นามสกุล">ชื่อ-นามสกุล</option>
        <option value="แผนก/ฝ่าย">แผนก/ฝ่าย</option>
        <option value="Plat">Plat</option>
    </select>
    
    <input type="text" id="searchInput" placeholder="กรอกคำค้นหา">
    <button onclick="searchData()">ค้นหา</button>

    <table id="dataTable">
        <thead>
            <tr>
                <th>รหัสพนักงาน</th>
                <th>ชื่อ-นามสกุล</th>
                <th>แผนก/ฝ่าย</th>
                <th>Plat</th>
            </tr>
        </thead>
        <tbody></tbody>
    </table>

    <script>
        let employeeData = []; // ตัวแปรเก็บข้อมูลจาก Excel

        // โหลดข้อมูลจากไฟล์ Excel ที่อยู่บนเซิร์ฟเวอร์
        fetch('employee-data.xlsx')
            .then(response => response.arrayBuffer())
            .then(data => {
                const workbook = XLSX.read(data, { type: 'array' });
                const sheetName = workbook.SheetNames[0]; // ชื่อชีตแรก
                const sheet = workbook.Sheets[sheetName];
                employeeData = XLSX.utils.sheet_to_json(sheet); // แปลงข้อมูลเป็น JSON

                displayData(employeeData); // แสดงข้อมูลในตาราง
            });

        // แสดงข้อมูลทั้งหมดในตาราง
        function displayData(data) {
            const tableBody = document.querySelector("#dataTable tbody");
            tableBody.innerHTML = ""; // ล้างข้อมูลเก่า
            data.forEach(row => {
                const tr = document.createElement("tr");
                tr.innerHTML = `
                    <td>${row["รหัสพนักงาน"] || '-'}</td>
                    <td>${row["ชื่อ-นามสกุล"] || '-'}</td>
                    <td>${row["แผนก/ฝ่าย"] || '-'}</td>
                    <td>${row["Plat"] || '-'}</td>
                `;
                tableBody.appendChild(tr);
            });
        }

        // ฟังก์ชันค้นหาข้อมูล
        function searchData() {
            const keyword = document.getElementById("searchInput").value.trim().toLowerCase();
            const column = document.getElementById("searchColumn").value;

            const filteredData = employeeData.filter(row =>
                row[column] && row[column].toString().toLowerCase().includes(keyword)
            );

            displayData(filteredData); // แสดงเฉพาะผลลัพธ์ที่ค้นหา
        }
    </script>

</body>
</html>
